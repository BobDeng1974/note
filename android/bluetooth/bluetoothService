//服务：
mSystemServiceManager.startService(BluetoothService.class)@SystemServer.java
BluetoothService-->new BluetoothManagerService@BluetoothService.java-->
BluetoothManagerService{
- loadStoredNameAndAddress//加载蓝牙名字地址
- mEnableExternal //蓝牙是否打开
}@BluetoothManagerService.java

mSystemServiceManager.startBootPhase@SystemServer.java-->startBootPhase-->
service.onBootPhase@SystemServiceManager.java-->onBootPhase(PHASE_SYSTEM_SERVICES_READY)
-->mBluetoothManagerService.handleOnBootPhase@BluetoothService.java-->
handleOnBootPhase{
- sendEnableMsg(mQuietEnableExternal)-->handleEnable-->doBind(IBluetooth)//打开蓝牙
- getNameAndAddress-->handleMessage(MESSAGE_GET_NAME_AND_ADDRESS)-->doBind(IBluetooth)
}@BluetoothManagerService.java

//启动服务
doBind(IBluetooth)@BluetoothManagerService.java-->onCreate@AdapterService.java

//adapter初始化
getDefaultAdapter-->new BluetoothAdapter(managerService)@BluetoothAdapter.java

//打开蓝牙
enable@BluetoothAdapter.java-->mManagerService.enable-->enable{
- 保存设置值，persistBluetoothSetting(Settings.Global.BLUETOOTH_ON)
- sendEnableMsg-->handleMessage(MESSAGE_ENABLE)-->handleEnable
}@BluetoothManagerService.java


frameworks/base/services/java/com/android/server/SystemServer.java
frameworks/base/services/core/java/com/android/server/SystemServiceManager.java
frameworks/base/services/core/java/com/android/server/BluetoothService.java
frameworks/base/services/core/java/com/android/server/BluetoothManagerService.java
frameworks/base/core/java/android/bluetooth/BluetoothAdapter.java

=======================
//AdapterService

onCreate{//启动
- AdapterServiceBinder
- AdapterState.make
}@AdapterService.java

processMessage-->adapterService.processStart@AdapterState.java-->setProfileServiceState
-->(启动Config.PROFILE_SERVICES中所有服务)startService@AdapterService.java

@AdapterState.java


//8.1
BleOnState.processMessage(USER_TURN_ON)@AdapterState.java-->startCoreServices-->
setProfileServiceState(supportedProfileServices,BluetoothAdapter.STATE_ON)@AdapterService.java

apps/Bluetooth/src/com/android/bluetooth/btservice/AdapterService.java
apps/Bluetooth/src/com/android/bluetooth/btservice/AdapterState.java


